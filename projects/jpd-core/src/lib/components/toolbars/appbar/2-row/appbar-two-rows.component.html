<!----------------------------------------------------->
<!--                  nav template                   -->
<!----------------------------------------------------->

<ng-template #actionsTemplate>
  <div class="px-2 d-flex align-items-center flex-row-reverse w-150px">
    <ng-content select="[action]"></ng-content>
  </div>
</ng-template>

<ng-template #navTemplate>
  <nav #navContainer class="d-flex" [style.visibility]="navVisible">

    @if (rootRoute.children.length === 1) {
      @for (childRoute of rootRoute.children[0].fragments; track childRoute) {
        <a mat-flat-button class="transparent-background text-capitalize"
           [routerLinkActiveOptions]="linkActiveOptions"
           [fragment]="childRoute" routerLinkActive="active" [routerLink]="[rootRoute.path]">
          {{ childRoute }}
        </a>
      }
    } @else {
      <!-- multi site. with sub routes -->
      @for (childRoute of rootRoute.children; track childRoute.name) {
        <a #ref mat-flat-button class="transparent-background text-capitalize demo-btn-color"
           routerLinkActive="active" [routerLink]="[rootRoute.path +'/'+ childRoute.path]"
           [routerLinkActiveOptions]="linkActiveOptions"
           (click)="showSubNav(childRoute, ref._elementRef.nativeElement.getBoundingClientRect().x)"
           (mouseenter)="showSubNav(childRoute,ref._elementRef.nativeElement.getBoundingClientRect().x)"
           (mouseleave)="hideSubNav()">
          {{ childRoute.name }}
        </a>
      }
    }
  </nav>
</ng-template>

<!----------------------------------------------------->
<!--                    mobile                       -->
<!----------------------------------------------------->
@if (isXSmall$|async) {
  <!--   mobile    -->
  <mat-toolbar class="z-2 fill mat-elevation-z6 position-relative">
    <button mat-icon-button (click)="emitNavToggle()">
      <mat-icon svgIcon="menu"/>
    </button>
    <div class="d-flex align-items-center w-150px">
      <ng-content select="[logo-small]"/>
    </div>
    <span class="spacer"></span>
    <ng-container [ngTemplateOutlet]="actionsTemplate"></ng-container>
  </mat-toolbar>
} @else {
  <!----------------------------------------------------->
    <!--                    desktop                      -->
    <!----------------------------------------------------->
  <mat-toolbar class="z-2 fill mat-elevation-z6 position-relative flex-column-reverse"
               [class.transparent-bg]="_transparent"
               [class.position-absolute]="_transparent || blurry"
               [class.rounded]="rounded"
               [class.blurry]="blurry"
               [style.background-color]="bgColor">

    <mat-toolbar-row>
      <div class="d-flex w-100 align-items-center justify-content-between">
        <div class="d-flex align-items-center w-150px">
          <ng-content select="[logo]"/>
        </div>
        @if ((isSmall$ | async) === false) {
          <ng-container [ngTemplateOutlet]="navTemplate"></ng-container>
        }
        <ng-container [ngTemplateOutlet]="actionsTemplate"></ng-container>

      </div>
    </mat-toolbar-row>


    @if (isSmall$ | async) {
      @if (isOpen) {
        <mat-toolbar-row class="second-toolbar">
          <div class="w-100">
            <ng-container [ngTemplateOutlet]="navTemplate"></ng-container>
          </div>
        </mat-toolbar-row>
      }
    }

  </mat-toolbar>
  <div>
    <ng-content select="[nav-menu]"></ng-content>
  </div>
}
